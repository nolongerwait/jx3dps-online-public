# 账号导入接入方案

## 1、前置条件

### 获取服务器列表

通过魔盒接口获取服务器列表，也可通过其余方式维护。

目标值：具体区服名称（例：电信区/绝代天骄）

```javascript
{
  url: 'https://spider2.jx3box.com/api/spider/server/server_state'
  method: 'GET'
}
```

### 获取授权 Key

和提供者约定授权密钥，用于后续请求签名的加密

## 2、导入接口

### 接口地址

```javascript
{
  url: 'https://dps.btcsg.top/api/equip'
  method: 'POST'
}
```

### 入参

```typescript
{
  /**
   * @name zone
   * @desc 大区名称，例：电信区
   */
  zone: string
  /**
   * @name server
   * @desc 大区名称，例：绝代天骄
   */
  server: string
  /**
   * @name signature
   * @desc 加密签名
   */
  signature: string
  /**
   * @name name
   * @desc 账号名称/UID
   */
  name: string
  /**
   * @name timestamp
   * @desc 时间戳 new Date().getTime()
   */
  timestamp: number
}
```

## 3、密钥加密

使用 SHA256 加密签名

```typescript
// 定义基础参数
const params = {
  zone: '电信区',
  server: '绝代天骄',
  name: '唐宋',
  timestamp: new Date().getTime(),
}

const signature = getSignature(params)

function getSignature(params) {
  const message = Object.entries(params)
    .sort(([a], [b]) => a.localeCompare(b))
    .map(([key, value]) => `${key}=${value}`)
    .join('&')

  const expectedSignature = CryptoJs.HmacSHA256(message, '替换为授权Key').toString(CryptoJs.enc.Hex)

  return expectedSignature
}

// 最终调用接口入参
const data = {
  ...params,
  signature,
}
// 调用接口获取数据
```

## 4、请求参数示例

验证加密方式是否正确，

```javascript
// 定义mock参数
const params = {
  zone: '电信区',
  server: '绝代天骄',
  name: '唐宋',
  timestamp: 1750386265035,
}

// 将以上参数带入加密函数，得到signature应为
const signature = 'e2abd947204cc897b45a3ac932ae4eed44f16b739ca0c1e0fa3ff83364b9f206'
```

最终请求接口参数

```json
{
  "zone": "电信区",
  "server": "绝代天骄",
  "name": "唐宋",
  "timestamp": 1750386265035,
  "signature": "e2abd947204cc897b45a3ac932ae4eed44f16b739ca0c1e0fa3ff83364b9f206"
}
```
